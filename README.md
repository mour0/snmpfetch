#  snmpfetch

[![License](https://img.shields.io/github/license/mour0/snmpfetch?style=for-the-badge)](https://github.com/mour0/snmpfetch/blob/main/LICENSE) [![os](https://img.shields.io/badge/ubuntu-v20.04.4%20LTS-orange?style=for-the-badge)]()


## About üìÑ
snmpfetch is a simple command-line program that uses the SNMP protocol to retrieve system information.  
It sends GET requests to a host where the SNMP daemon is running, parses the data, and prints them.  

[![asciicast](https://asciinema.org/a/LjwGWGZPLLV98vQmmpPPBgczt.svg)](https://asciinema.org/a/LjwGWGZPLLV98vQmmpPPBgczt)
---

## Installation üß∞
### Ubuntu
1. [Install Rust](https://www.rust-lang.org/tools/install)
2. ```apt-get install snmp snmpd snmp-mibs-downloader libssl-dev```
3. ```sed -i 's/mibs :/# mibs :/g' /etc/snmp/snmp.conf```
4. Add to `/etc/snmp/snmpd.conf` :
```
view systemonly included .1.3.6.1.4.1.2021
view systemonly included .1.3.6.1.2.1.25
```
5.  Run `service snmpd restart`
6. ```git clone https://github.com/mour0/snmpfetch.git```
7. ```cd snmpfetch/```
8. ```cargo build --release```
9. ```./snmpfetch 127.0.0.1```

## Tests ü•º
### Readings
- **sysName** and **sysDescr** they can be retrieved using the commands `uname -n` and `uname -a`
- **hrSystemUptime** using the command `uptime -p`
- **hrSystremProcesses** by `ps aux`
- **cpuUsage** by `iostat`
- **memTotal** and **memUsed** by `free`
- **Loads** by `top`. The value showed by `top` is divided by 100

### Notifications
To check if notifications are correctly sent, we can use `stress` and we must reduce the threshold values in the config file accordingly.  
The tool can be installed using `apt-get install stress`

#### Example
Edit the following snmpfetch_config.toml fields
```toml
[contacts]
# If you want to receive notifications set ur URL
webhook = "<URL>"
    
[timings]
# Seconds to wait before sending webhook
webhook_pause = 120 #  2 minutes
# Seconds between snmpfetch executions
interval = 1

[thresholds]
# Percentage of used memory
used_mem = 20
# Load 1 minute value
load_1m = 300

[database]
influxdb_url = "http://localhost:8086"
influxdb_name = "test"
grafana_url = "http://localhost:3000"
```
1. Run the command `stress --cpu 4 --vm 2 --vm-bytes 512M &` 
2. Run `./snmpfetch 127.0.0.1 -t 2.5 -L`
3. Check if you receive any type of notification in ur webhook channel and stop `snmpfetch`
4. Terminate `stress`

## FAQs ‚ùì
### How to install Grafana and InfluxDB 1.8 
1. Download [Grafana](https://grafana.com/grafana/download?edition=oss) and [InfluxDB 1.8](https://portal.influxdata.com/downloads/)
2. Start Influxd: `service influxdb start`
3. Start Grafana Server: `service grafana-server start`
4. run `influx` and execute `CREATE DATABASE test`
5. Visit [127.0.0.1:3000](http://127.0.0.1:3000) and enter `admin` in both fields
6. Continue the configuration then go to [127.0.0.1:3000/datasources](http://127.0.0.1:3000/datasources) and click on `Add data source`
7. Search `InfluxDB` and set the following parameters:
	- Name:  `test`
	- URL:  `http://localhost:8086`
	- DATABASE: `test`
	- HTTP Method: `GET`
8. Click `Save & Test`

### How to create the snmpfetch_config.toml file?
A sample can be generated by executing the program (ex. `./snmpfetch 127.0.0.1`)


